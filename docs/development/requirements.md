## ---

**【簡易版】要件定義書：Slackチャンネル履歴取得ツール**

### **1\. 目的・背景**

* **目的**:  
  * プロジェクトの振り返り（レトロスペクティブ）を効率的かつ客観的に行うため、特定のSlackチャンネルのコミュニケーション履歴をテキストデータとして取得する。  
* **背景**:  
  * プロジェクト期間中の議論や決定事項、課題の発見などがSlack上に点在している。これらを手動で追跡・収集するのは手間がかかるため、自動で履歴を取得するツールを開発する。

### **2\. 開発物の概要**

* **名称**: Slackチャンネル履歴取得ツール  
* **種別**: CUI（コマンドライン）ツール  
* **概要**:  
  * 指定されたSlackチャンネルID、期間（開始日・終了日）に基づき、Slack APIを利用してメッセージ履歴を取得する。  
  * 取得した履歴を、分析しやすい形式（CSV）で出力する。  
* **実行環境**:  
  * 開発者のローカルPC環境（macOS）

### **3\. 機能要件**

| 優先度 | 機能 | 詳細 |
| :---- | :---- | :---- |
| **Must** | **Slack認証機能** | ・設定ファイルまたは環境変数からSlack APIトークンを読み込み、API利用のための認証を行う。 |
| **Must** | **パラメータ指定機能** | ・以下のパラメータをコマンド実行時に指定できる。\<br\>　- SlackチャンネルID (channel\_id)\<br\>　- 取得開始日 (start\_date)\<br\>　- 取得終了日 (end\_date) |
| **Must** | **メッセージ履歴取得機能** | ・指定されたチャンネルと期間のメッセージ履歴をconversations.history API等を利用して取得する。\<br\>・スレッド内の返信（リプライ）もすべて取得する。 |
| **Must** | **CSVファイル出力機能** | ・取得したメッセージ履歴をCSV形式のファイルとして出力する。\<br\>・出力ファイル名はパラメータで指定できるようにする。（例： output.csv） |
| **Should** | **ユーザー情報取得機能** | ・メッセージの投稿者IDだけでなく、表示名も取得してCSVに含める。 |
| **Could** | **リアクション情報取得** | ・各メッセージに付与されたリアクションの種類と数を取得し、CSVに含める。 |

### **4\. 非機能要件**

* **セキュリティ**:  
  * Slack APIトークンをソースコード内に直接記述（ハードコーディング）しないこと。必ず環境変数や外部の設定ファイル（.envファイルなど）で管理する。  
* **性能**:  
  * Slack APIのレートリミット（Tier 2: 20+ reqs/min程度）を考慮し、APIリクエストの間に適切な待機時間（sleep）を設けること。  
* **保守性**:  
  * ツールの使い方、設定方法、実行方法を記載した簡単なドキュメント（README.md）を作成する。

### **5\. データ要件**

* **入力データ**:  
  * Slack APIトークン（xoxb-で始まるBot Token）  
  * Slack チャンネルID（例: C0123456789）  
  * 取得期間（開始日・終了日、例: 2024-04-01 \~ 2024-06-30）  
* **出力データ（CSVフォーマット例）**:

| カラム名 | データ型 | 説明 |
| :---- | :---- | :---- |
| message\_ts | string | メッセージのタイムスタンプ (例: "1704067200.000100") |
| datetime | string | 人間が読める形式の日時 (例: "2024-01-01 09:00:00") |
| user\_id | string | 投稿者のユーザーID (例: "U01234567") |
| user\_name | string | 投稿者の表示名 (例: "山田 太郎") |
| text | string | メッセージ本文 |
| thread\_ts | string | このメッセージが属するスレッドの親メッセージのts。親の場合は空。 |
| reactions | string | リアクションの集計 (例: "thumbsup:3, smile:1") |

### **6\. 制約・前提条件**

* **開発言語**: **Ruby 3.x**  
* **利用ライブラリ**: **slack-ruby-client**, **dotenv** 等  
* **API**: Slack APIを利用する。事前に利用したいAPIのスコープ（channels:history, groups:history, users:read 等）を持つSlack AppとBot Tokenの作成が必要。

---

